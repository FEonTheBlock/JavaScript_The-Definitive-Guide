# 자바스크립트 완벽 가이드 11주차 학습 - 혜연

## 15장 웹 브라우저의 자바스크립트

15.11~13, 14옵션

### 15.11 네트워크

- 웹 브라우저는 네트워크에 사용할 수 있는 자바스립트 API를 제공함.

#### 15.11.1 fetch()

- 기본적인 HTTP 요청에서의 fetch()의 동작
  1. 콘텐츠를 가져올 URL을 전달하면서 fetch()를 호출
  2. HTTP 응답이 도착하기 시작하면 비동기적으로 반환한 응답 객체를 가져오고 이 응답 객체의 메서드를 호출해 응답 바디를 가져옴.
  3. 바디 객체를 사용해 필요한 일을 함.
- 프라미스 기반인 fetch() API는 두 단계의 비동기 단계로 이루어져 있어 then()을 두 번 호출하거나 await 표현식을 두 번 써야 함.
- fetch() API는 XMLHttpRequest를 대체함.
- fetch()는 서버의 응답이 도착하기 시작할 때, 즉 HTTP 상태와 응답 헤더를 받는 즉시, 일반적으로 응답 바디 전체가 도착하기 전에 프라미스를 해석함.
- 웹 서버가 feetch() 요청에 응답하면 프라미스는 그 응답 객체로 이행됨.
- fetch()를 호출할 때는 항상 .catch()를 함께 사용하는 것이 좋음.
- 요청을 보내면서 URL과 함께 매개변수를 전달해야 한다면 URL 마지막 ? 뒤에 이름-값 쌍을 추가하거나 fetch()의 첫 번째 인자로 URL 객체를 전달
- fetch() 요청을 보내면서 헤더를 설정해야 할 때 fetch()에 두 번째 인자를 사용
- fetch()의 두 번째 단계에서 json(), text(), arrayBuffer(), blob(), formData()로 웹 서버의 응답을 얻을 수 있음.
- POST, PUT, DELETE와 같은 요청 메서드를 사용할 때는 fetch() 두 번째 인자로 설정 객체를 전달

#### 15.11.2 서버 전송 이벤트

- 클라이언트 사이드 자바스크립트에서 서버가 클라이언트에 메시지를 전송하는 패턴을 위해 EventSource API를 지원
- 클라이언트가 EventSource 객체를 생성해 서버에 연결을 보내면 서버는 이 연결을 열어 두고, 이벤트가 일어나면 서버는 이 연결에 텍스트를 보냄.

#### 15.11.3 웹소켓

- 웹소켓 API는 복잡하고 강력한 네트워크 프로토콜의 단순한 인터페이스
- 브라우저는 웹소켓을 통해 텍스트나 이진 메시지를 서버와 쉽게 주고받을 수 있음.
- 이진 메시지를 지원하며 양방향 통신이 가능
- 웹 소켓 프로토콜을 사용하는 서비스에 연결할 때는 wss://로 시작하는 URL을 사용
- 클라이언트 사이드 자바스크립트에서 웹소켓을 사용하기 위해서는 웹소켓 프로토콜을 지원하는 웹 서버가 있어야 하고, 웹소켓 프로토콜로 데이터를 주고받는 서버사이드 코드가 필요함.
- 웹소켓 서버와 통신하려면 wss:// URL을 전달해 웹소켓 객체를 만들고, 소켓의 readyState 프로퍼티의 값이 WebSocket.OPEN일 때 통신할 수 있고, open 이벤트가 일어남.
- 웹소켓 사용이 끝나면 웹소켓 객체의 close() 메서드를 호출해 연결을 끊음.
- 웹소켓으로 연결된 서버에 메시지를 보낼 때는 웹소켓 객체의 send() 메서드를 호출
- WebSocket() 생성자를 호출할 때 두 번째 인자로 처리 방법을 알고 있는 애플리케이션 프로토콜 문자열 배열을 전달하여 서버에 이 중 하나를 택하도록 요청할 수 있음.
- 연결이 성립되면 웹소켓 객체의 protocol 프로퍼티에 서버가 선택한 프로토콜 버전이 할당됨.

### 15.12 스토리지

- 웹 애플리케이션은 브라우저 API를 사용해 사용자의 컴퓨터에 데이터를 저장할 수 있음.
- 클라이언트 사이드 스토리지는 웹 브라우저의 메모리처럼 사용됨.
- 웹 스토리지
  - 문자열 키와 문자열 값을 연결한 지속성 있는 객체인 localStorage, sessionsStorage로 구성
  - 사용하기 쉽고 많은 데이터를 저장할 수 있지만 방대한 양을 저장할 수는 없음.
- 쿠키
  - 원래 서버 사이드 스크립트에서 사용하도록 설계된 매커니즘
  - 클라이언트 사이트에서 쿠키를 다루기는 어렵고 텍스트 데이터를 소량만 저장할 수 있음.
  - HTTP 요청이 있을 때마다 항상 서버로 전송
- IndexedDB
  - 인덱스를 지원하는 객체 데이터베이스의 비동기 API

#### 15.12.1 로컬스토리지와 세션스토리지

- 스토리지 객체와 일반적인 자바스크립트 객체의 차이점
  - 스토리지 객체의 프로퍼티 값에는 문자열만 쓸 수 있음.
  - 스토리지 객체에 저장된 프로퍼티에는 지속성이 있음.
- 문자열이 아닌 데이터를 저장할 때는 직접 인코드/디코드해야 함.
- localStorage에 저장된 데이터는 만료되지 않으며, 웹 애플리케이션에서 삭제하거나 사용자가 브라우저 UI를 통해 삭제하지 않는 한 사용자의 장치에 계속 남음.
- localStorage는 문서 출처와 브라우저에 종속됨.
- sessionStorage에 저장된 데이터는 최상위 창이나 브라우저 탭이 닫힐 때 사라짐.
  - 최신 브라우저에서는 더 오래 지속될 수 있음.
- sessionStorage는 문서 출처와 브라우저 탭에 종속됨.
- localStorage에 저장된 데이터가 변경될 때마다 그 데이터를 볼 수 있는 모든 Window 객체에서 스토리지 이벤트가 일어남.

#### 15.12.2 쿠키

- 쿠키: 특정 웹 페이지 또는 웹사이트와 연관된 소량의 이름 붙은 데이터
- 자바스크립트의 쿠키는 어떤 종류의 암호화도 지원하지 않으므로 안전하지 않음.
- 쿠키는 기본적으로 일시적이며 쿠키에 저장되는 값은 웹 브라우저 세션의 지속 시간 동안만 유지되고, 사용자가 브라우저를 종료하면 사라짐.
- max-age 속성에 쿠키의 유지 시간을 초 단위로 지정하여 지정된 기간이 만료됐을 때만 삭제하도록 할 수 있음.
- 쿠키의 범위는 문서 출처와 문서 경로의 영향을 받음.
- 쿠키의 path 속성을 지정하면 같은 웹 서버 내 웹 페이지 중 URL이 지정된 경로로 시작하는 페이지는 모두 그 쿠키를 공유할 수 있음.
- secure 속성을 이용하여 쿠키를 보안으로 지정하면 브라우저와 서버가 HTTPS 또는 보안 프로토콜로 연결됐을 때만 전송됨.
- 쿠키 값을 현재 문서에 연결할 때는 cookei 프로퍼티에 name=value 문자열을 할당

#### 15.12.3 IndexedDB

- IndexedDB는 객체 데이터베이스로, SQL 쿼리를 지원하는 데이터베이스에 비해 단순하며 localStorage의 키-값 스토리지보다 강력하고 효율적
- 문서의 출처에 종속됨.
- 데이터베이스의 개수에는 제한이 없으며, 데이터베이스의 이름은 반드시 해당 출처 내에서 고유해야 함.
- 원자성(atomicity)을 보장하여 데이터베이스는 전부 성공하거나 전부 실패하는 두 가지 경우만 있으며 일부만 업데이트된 상태(정의되지 않은 상태)로 두지 않음.
- 비동기적으로 동작함.

### 15.13 워커 스레드와 메시지

- Worker 클래스의 인스턴스는 메인 스레드, 이벤트 루프와 동시에 실행되는 스레드로 워커는 독립된 실행 환경에서 실행되며 완전히 독립적인 전역 객체를 갖고, Window나 Document 객체에 접근하지도 않음.
- 애플리케이션에서 이미지 처리 같은 계산 집약적인 작업을 할 때 유용

#### 15.13.1 Worker 객체

- 새로운 워커를 생성할 때는 워커가 실행할 자바스크립트 코드를 URL로 전달하면서 Worker() 생성자를 호출
- 문자열뿐 아니라 객체, 배열, 형식화 배열, 맵, 세트 등도 전달 가능
- Worker 객체의 message 이벤트를 주시해 워커에서 메시지를 수신할 수 있음.

#### 15.13.2 워커의 전역 객체

- Worker() 생성자로 새로운 워커를 생성할 때 전달한 자바스크립트 코드 파일의 URL은 워커를 생성한 스크립트에서 분리된 새로운 자바스크립트 실행 환경에서 실행되고, 이 실행 환경의 전역 객체는 WorkerGlobalScope 객체임.
- WorkerGlobalScope는 워커의 전역 객체이므로 워커 코드는 postMessage(), onmessage를 전역 함수와 전역 변수처럼 사용함.
- Worker() 생성자에 두 번째 인자로 전달하는 객체에 name 프로퍼티가 있으면 그 값은 워커의 전역 객체의 name 프로퍼티 값이 됨.

#### 15.13.3 워커로 코드 가져오기

- 모든 워커에서 접근할 수 있는 importScripts() 전역 함수로 하나 이상의 URL 인자를 전달하면 이 파일들은 지정된 순서대로 동기적으로 불러와 실행됨.
- importScripts()는 동기적 함수이며 스크립트 전체를 불러와서 실행할 때까지 종료되지 않음.

#### 15.13.4 워커 실행 모델

- 워커 스레드는 코드, 가져온 스크립트나 모듈을 동기적으로 실행하며, 이벤트와 타이머에 응답할 때는 비동기 단계에 들어감.
- Worker 객체에는 워커 스레드가 실행 중인지 아닌지 판단할 수 있는 프로퍼티나 메서드가 없으므로 부모 스레드와 통신하지 않은 채 스스로 종료하도록 두면 안 됨.

#### 15.13.5 postMessage(), MessagePort, MessageChannel

- MessagePort는 postMessage() 메서드와 onmessage 이벤트 핸들러 프로퍼티를 가진 객체
- 연결된 쌍의 한쪽 포트에서 postMessage()를 호출하면 반대쪽 포트에서 message 이벤트가 일어나고, 이 이벤트를 onmessage 프로퍼티나 message 이벤트 리스너로 수신할 수 있음.

#### 15.13.6 postMessage()를 통한 교차 출처 메시지

- 워커의 postMessage()는 독립적인 두 스레드가 메모리를 공유하지 않고 통신하는 안전한 방법
- 브라우저 창의 postMessage()는 추러가 다른 창끼리 안전하게 메시지를 교환하는 방법
- message 이벤트를 받을 때는 스크립트에서 조작이 불가능한 origin 프로퍼티를 확인해서 원하던 메시지인지 체크할 수 있음.
