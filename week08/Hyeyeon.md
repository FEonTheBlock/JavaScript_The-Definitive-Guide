# 자바스크립트 완벽 가이드 8주차 학습 - 혜연

## 15장 웹 브라우저의 자바스크립트

- 클라이언트 사이드 자바스크립트: 웹 브라우저에서 실행하도록 작성한 자바스크립트

### 15.1 웹 프로그래밍 기본

#### 15.1.1 HTML `<script>` 태그 속의 자바스크립트

- 웹 브라우저에서 자바스크립트 코드를 실행하려면 `<script>` 태그를 이용해 HTML 문서에 자바스크립트를 포함헤야 함.
- `<script>` 태그 src 속성의 장점
  - HTML 문서에서 자바스크립트 코드를 분리하여 단순화함.
  - 여러 페이지에서 같은 자바스크립트 코드를 공유할 수 있음.
    - 이 경우 브라우저 캐시를 이용하여 자바스크립트 코드를 내려 받는 횟수를 줄일 수 있음.
  - 다른 웹 서버에서 코드를 가져올 수 있음.
- 모듈
  - 자바스크립트를 모듈로 작성하면 최상위 모듈을 `<script type="module">` 태그로 불러와야 함.
- 스크립트 타입 지정
  - 자바스크립트는 웹의 기본 언어이자 유일한 언어이므로 `<script>` 태그의 language 속성은 불필요함.(폐기)
  - type 속성은 스크립트가 모듈일 때, 웹 페이지에 데이터를 가져오지만 표시하지는 않을 때에만 사용
- 스크립트 실행 시점: async와 defer
  - `<script>` 태그에 defer, async 속성을 이용하여 스크립트 실행 방식을 바꿀 수 있음.
    src 속성과 함께 사용해야만 의미가 있음.
  - defer 속성은 문서를 완전히 내려받고 분석해서 조작할 준비가 끝날 때까지 스크립트 실행을 지연함.
  - async 속성은 브라우저가 스크립트를 가능한 한 빨리 실행하되 스크립트를 내려받는 동안 문서 분석을 계속 할 수 있게 함.
  - defer와 async 두 속성이 모두 존재할 경우 async 속성이 우선함.
  - `type="module"` 속성이 있는 경우 기본적으로 defer 속성이 있는 것처럼 동작함.
- 필요에 따른 스크립트 로드
  - 문서를 처음 불러올 때는 필요 없지만 특정 상황에만 필요한 자바스크립트 코드는 모듈을 사용하여 import()로 필요한 모듈만 불러 오거나 스크립트를 불러올 때 문서에 `<script>` 태그를 추가하여 자바스크립트 파일을 불러올 수 있음.

#### 15.1.2 문서 객체 모델

- Document 객체: 브라우저 창이나 탭에 표시되는 HTML 문서를 나타내는 객체
- DOM(Document Object Model, 문서 객체 모델): HTML 문서를 다루는 API
- DOM API는 HTML 문서의 트리 구조를 반영함.
- Node 객체는 트리 구조로 되어 있어 자바스크립트에서 DOM API를 사용해 검색하고 이동할 수 있음.
- 각 HTML 태그 타입에 대응하는 자바스크립트 클래스가 있고, 문서에 존재하는 각 태그는 클래스의 인스턴스로 표현됨.

#### 15.1.3 웹 브라우저의 전역 객체

- 브라우저 창이나 탭마다 이에 대응하는 전역 객체가 하나씩 있으며, 워커 스레드를 제외한 모든 자바스크립트 코드는 전역 객체를 공유함.
- 웹 브라우저에서 전역 객체는 다양한 웹 API의 진입점
- 웹 브라우저의 전역 객체에는 window 프로퍼티가 있으며, 그 값은 전역 객체 자체임.

#### 15.1.4 네임스페이스를 공유하는 스크립트

- 모듈이 아닌 스크립트에서 최상위 코드가 상수, 변수, 함수, 클래스를 정의하면 그 선언은 같은 문서에서 실행된 모든 스크립트에서 볼 수 있고, 문서에 존재하는 독립적인 스크립트들이 네임스페ㅔ이스를 공유하며 거대한 스크립트의 일부인 것처럼 행동함.
  - 작은 프로그램에서는 편리할 수 있으나 큰 프로그램에서는 문제가 될 수 있음.
  - ES6의 const, let, class는 최상위 레벨에서 사용하더라도 전역 객체가 아니라 공유된 네임스페이스 안에 생성됨.

#### 15.1.5 자바스크립트 프로그램 실행

- 웹 페이지에 `<iframe>` 요소로 임베드된 문서의 자바스크립트 코드는 임베드한 문서와 별도의 자바스크립트 프로그램이라고 볼 수 있음.
- 자바스크립트 프로그램의 두 단계
  1. 문서 콘텐츠를 불러오고 `<script>` 요소의 코드를 실행
  2. 비동기적으로 일어나는 이벤트에 응답해 이벤트 핸들러나 기타 콜백을 호출
  - 이 단계에서 DOMContentLoaded와 load 이벤트가 처음 일어남.
  - DOMContentLoaded: HTML 문서의 로딩과 분석이 완전히 끝났을 때 일어나는 이벤트
  - load: 이미지 같은 문서의 외부 자원을 완전히 불러왔을 때 일어나는 이벤트
- 클라이언트 사이드 자바스크립트 스레드 모델
  - 자바스크립트는 싱글 스레드 언어
    - 웹 브라우저가 스크립트와 이벤트 핸들러를 실행하는 동안 사용자 입력에 반응하지 않음.
    - 스크립트에서 과도한 계산을 수행하면 문서 로딩이 지연되고 사용자는 스크립트 실행이 완료될 때까지 문서 콘탠츠를 볼 수 없음.
    - 웹 플랫폼은 '웹 워커'를 통해 동시성을 구현함.
      - 웹 워커: 사용자 인터페이스를 멈추지 않으면서 실행되는 백그라운드 스레드
      - 웹 워커 스레드에서 실행되는 코드는 문서 콘텐츠에 접근할 수 없고, 메인 스레드나 다른 워커와는 상태를 공유하지 않으면서 오로지 비동기 메시지 이벤트를 통해서만 통신함.
- 클라이언트 사이드 자바스크립트 타임라인
  1. 웹 브라우저가 Document 객체를 생성하고 웹 페이지 분석을 시작
  2. HTML 파서가 `<script>` 태그를 만나면 스크립트 태그를 문서에 추가하고 스크립트를 실행함. HTML 파서는 스크립트를 내려받아 실행하는 동안 일시 중지
  3. 파서가 async 속성이 있는 `<script>` 요소를 만나면 스크립트 텍스트를 내려받기 시작하고, 모듈 스크립트를 재귀적으로 내려받아 문서 분석을 계속함.
  4. 문서 분석이 완전히 끝나면 document.readyState 프로퍼티가 interactive로 바뀜.
  5. defer 속성이 있는 스크립트, async 속성이 없는 모듈 스크립트, 비동기 스크립트가 실행됨.
  6. 브라우저가 Document 객체에서 DOMContentLoaded 이벤트를 일으킴.
  7. 콘텐츠 로딩이 끝나고 document.readyState 프로퍼티는 complete로 바뀌고 웹 브라우저는 Window 객체에서 load 이벤트를 일으킴.
  8. 이벤트 핸들러가 비동기적으로 호출됨.

#### 15.1.6 프로그램 입출력

- 자바스크립트 프로그램에서 사용할 수 있는 입력 형태
  - DOM API를 통해 접근할 수 있는 문서 콘텐츠 자체
  - 이벤트 형태인 사용자 입력
  - 문서 URL: document.URL로 접근
  - HTTP 쿠키 요청 헤더 콘텐츠: document.cookie로 사용
  - 전역 navigator 프로퍼티를 통해 웹 브라우저, 운영 체제와 그 기능에 접근

#### 15.1.7 프로그램 에러

- 자바스크립트 프로그램이 실행되는 동안 예외가 일어나고 그 예외를 처리할 catch 문이 없다면 개발자 콘솔에 에러 메시지가 표시되지만 등록된 이벤트 핸들러는 계속 실행되며 이벤트에 반응
- 예외가 일어났을 때 호출될 에러 핸들러가 필요하다면 Window 객체의 onerror 프로퍼티에 에러 핸들러 함수를 정의할 수 있음.

#### 15.1.8 웹 보안 모델

- 브라우저 제조사들은 다음 두 가지 목표 간의 균형을 맞추기 위해 노력해 옴.
  - 유용한 웹 애플리케이션을 사용할 수 있는 강력한 클라이언트 사이드 API를 정의
  - 악의적인 코드에서 데이터를 읽거나 수정하지 못하게 하고, 개인 정보에 접근하지 못하게 방지
    - 클라이언트 사이드 자바스크립트는 클라이언트 컴퓨터의 디렉터리를 읽거나 파일을 수정, 삭제할 수 없음.
    - 클라이언트 사이드 자바스크립트에는 범용 네트워크 기능이 없음.
    - 동일 출처 정책
    - 교차 사이트 스크립트

### 15.2 이벤트

- 이벤트 타입: mousemove, keydown과 같이 이벤트 종류를 지정하는 문자열
- 이벤트 대상: 이벤트가 일어난, 또는 이벤트와 연관된 객체
- 이벤트 핸들러(이벤트 리스너): 이벤트를 처리하거나 이벤트에 반응하는 함수
- 이벤트 객체: 특정 이벤트와 연관되어 있으며 해당 이벤트에 관한 세부 정보를 포함하고, 이벤트 핸들러 함수에 인자로 전달됨.
- 이벤트 전달
  - HTML 문서의 요소에서 일어나는 일부 이벤트는 문서 트리를 따라 전달됨.

#### 15.2.1 이벤트 범주

- 장치 의존적인 입력 이벤트
  - 마우스, 키보드 등의 특정 입력 장치에 묶인 이벤트
  - mousedown, touchstart, keyup 등
- 장치 독립적인 입력 이벤트
  - 특정 입력 장치에 매여 있지 않은 이벤트
  - click, input, pointerdown 등
- 사용자 인터페이스(UI) 이벤트
  - HTML 폼 요소에서 자주 사용되는 고수준 이벤트
  - focus, change, sunmit 등
- 상태 전환 이벤트
  - 네트워크와 브라우저 활동에 의해 일어나며 일종의 라이프 사이클이나 상태가 변경됐음을 알리는 이벤트
  - load, DOMContentLoded, online, popstate 등
- API 전용 이벤트
  - 웹 API가 가지는 자신만의 이벤트 타입
  - waiting, playing, seeking, volumechange 등

### 15.3 문서 스크립트

- Document 객체는 단독으로 존재하지 않고, 문서 콘텐츠를 표현하고 조작하는 DOM의 중심임.

#### 15.3.1 문서 요소 선택

- CSS 선택자로 요소 선택
  - 지정된 CSS 선택자에 일치하는 요소를 선택
  - querySelector(), querySelectorAll()
  - querySelectorAll()의 반환값은 노드리스트 객체
- 다른 요소 선택 메서드
  - getElementById(), getElementsByName, getElementsByClassName 등
  - getElementById는 객체 하나를 반환, 나머지는 노드리스트를 반환
  - 살아 있는 노드리스트를 반환하므로 문서 콘텐츠나 구조가 변하면 반환되는 노드리스트가 바뀜.
- 미리 선택된 요소
  - `<img>` 요소에 접근하는 images 프로퍼티, `<form>` 요소에 접근하는 forms 프로퍼티, `<a>` 요소(단, href 속성이 있어야 함.)에 접근하는 links 프로퍼티 등
  - 요소 ID나 이름으로 인덱스됨.

#### 15.3.2 문서 구조와 순회

- 순회 API는 문서를 Element 객체의 트리로 취급하며 Text 노드는 무시함.
- parentNode: 요소의 부모를 참조함.
- children: 요소의 자식 요소를 참조하는 노드리스트
- childElementcount: 자식 요소의 개수
- firstElementChild, lastElementChild: 요소의 자식 중 첫 번째와 마지막을 각각 참조
- nextElementSibling, previousElementSibling: 요소의 바로 앞이나 바로 다음에 있는 형제 요소를 참조
- 노드 트리인 문서
  - Text 노드를 포함하여 문서 전체나 일부를 순회할 때는 Node 객체의 다른 프로퍼티를 사용함.
- parentNode: 현재 노드의 부모
- childNodes: 현재 노드의 자식 전체를 포함하는 읽기 전용 노드리스트
- firstChild, lastChild: 혆재 노드의 첫 번째와 마지막 자식 노드
- nextSibling, previousSibling: 현재 노드의 다음, 이전 형제 노드로, 노드를 이중으로 연결된 리스트로 연결함.
- nodeType: 노드의 종류를 나타내는 숫자로, Document 노드는 9, Element 노드는 1, Text 노드는 3, Comment 노드는 8
- nodeValue: Text나 Comment 노드의 텍스트 콘텐츠
- nodeName: 요소의 HTML 태그 이름을 대문자로 변환한 문자열

#### 15.3.4 요소 콘텐츠

- HTML인 요소 콘텐츠
  - innerHTML: 요소 콘텐츠를 마크업 문자열로 반환
  - outerHTML: innerHTML과 비슷하나 그 값에 요소 자체가 포함됨.
  - insertAdjaceentHTML(): 지정된 요소에 인접한 위치에 임의의 HTML 마크업을 삽입
- 일반 텍스트인 요소 콘텐츠
  - textContent: 요소 콘텐츠를 일반 텍스트로 가져오거나 문서에 일반 텍스트를 삽입할 때 사용

#### 15.3.5 노드 생성, 삽입, 삭제

- 새로운 요소를 생성: createElement()
- 요소에 문자열이나 다른 요소를 삽입: append(), prepend()
- 요소를 복사: cloneNode()
- Element 노드나 Text 노드를 제거: remove()
- 다른 요소로 교체: replaceWith()
- appendChild(), insertBefore(), replaceChild(), removeChild()는 사용하기 까다롭고 사용할 일도 거의 없음.
