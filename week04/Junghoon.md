# 이터레이터와 제너레이터

## 이터레이터 동작 방법

자바스크립트의 순회를 이해하려면 세 가지를 이해해야 한다.

1. 이터러블 객체 - 배열, Set, Map 같은 순회할 수 있는 타입의 객체
2. 이터레이터 객체 - 순회를 수행하는 객체
3. 순회 단계의 결과를 담은 이터레이션 리절트 객체

- 이터레이터 객체를 반환하는 특별한 이터레이터 메서드를 가진 객체는 모두 이터러블 객체이다.
- 순회 결과 객체를 반환하는 next() 메서드가 있는 객체는 모두 이터레이터 객체이다.
- 순회 결과 객체는 value와 done 프로퍼티가 있는 객체이다.

이터러블 객체를 순회할 때는 먼저 이터레이터의 메서드를 호출해 이터레이터 객체를 얻는다. 그리고 이터레이터 객체의 next() 메서드를 반복적으로 호출하며 반환 값의 done 프로퍼티가 true일 때까지 반복한다.  
여기서 이터러블 객체의 이터레이터 메서드는 일반적인 이름을 사용하는 것이 아니라 Symbol.iterator를 이름으로 사용한다.  
내장된 이터러블 데이터 타입의 이터레이터 객체는 그 자체가 이터러블이다. 즉, 자기 자신을 반환하는 Symbol.iterator 메서드를 갖는다. 부분적으로 사용된 이터레이터를 순회할 때 이런 특징이 유용할 때가 간혹 있다.

## 제너레이터

제너레이터의 일차적인 설계 목적은 이터레이터를 쉽게 생성하는 것이다.  
제너레이터는 코드 블록의 실행을 일시 중지했다가 필요한 시점에 재개할 수 있는 특수한 함수다.

제너레이터 함수는 함수 호출자에게 함수 실행의 제어권을 양도할 수 있고, 함수의 호출자와 함수의 상태를 주고받을 수 있다.
제너레이터 함수를 호출하면 제너레이터 객체를 반환하는데, 이는 이터러블이면서 동시에 이터레이터다.

### 제너레이터랑 이터레이터 객체의 차이

제너레이터 객체는 next 메서드를 갖는 이터레이터이지만 이터레이터에 없는 return, throw 메서드를 갖는다.
제너레이터 객체의 세 개의 메서드를 호출하면 다음과 같이 동작한다.

- next 메서드를 호출하면 제너레이터 함수의 yield 표현식까지 코드 블록을 실행하고, yield된 값을 value 프로퍼티 값으로, false를 done 프로퍼티 값으로 갖는 이터레이터 리절트 객체를 갖는다.
- return 메서드를 호출하면 인수로 전달받은 값을 value 프로퍼티 값으로, true를 done 프로퍼티 값으로 갖는 이터레이터 리절트 객체를 반환한다.
- throw 메서드를 호출하면 인수로 전달받은 에러를 발생시키고 undefined를 value 프로퍼티 값으로, true를 done 프로퍼티 값으로 갖는 이터레이터 리절트 객체를 반환한다.

### 제너레이터 일시 중지와 재개

- 제너레이터는 yield 키워드와 next 메서드를 통해 실행을 일시 중지했다가 필요한 시점에 다시 재개할 수 있다.
- 일반 함수는 호출 이후 제어권을 함수가 독점하지만 제너레이터는 함수 호출자를 제어권에게 양도하여 필요한 시점에 함수 실행을 재개할 수 있다.
- 제너레이터 객체의 next 메서드를 호출하면 yield 표현식까지 실행되고 일시 중지된다. 이때 함수의 제어권이 호출자로 양도된다.
- 이때 제너레이터 객체의 next 메서드는 value, done 프로퍼티를 갖는 이터레이터 리절트 객체를 반환한다.

### async 함수를 어떻게 구현할 수 있는가

자바스크립트의 제너레이터를 활용하여 구현할 수 있다고 생각한다.  
제너레이터 함수를 인수로 받는 async 함수를 만든 뒤, async 함수 내부에서 인수로 받은 제너레이터 함수를 실행하여 변수에 제너레이터 객체를 저장한다.

그리고 제너레이터를 참조하여 next메서드를 실행하고 done 프로퍼티가 true라면 value를 false라면 제네레이터 함수가 끝까지 실행되지 않았으므로 value의 후속처리 메서드를 실행하여 다시 resolve한 결과를 인수로 재귀 호출하는 클로저를 반환한다.  
사용할 때는 yield 키워드를 마치 await처럼 사용하면 async, await처럼 동작하게 구현할 수 있다.
